<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Send Data to Google Apps Script</title>
</head>
<body>
  <h1>Send Location and Photo to Google Apps Script</h1>
  
  <!-- Button to send location -->
  <button id="sendLocationBtn">Send Location</button>
  
  <!-- Input for photo upload -->
  <input type="file" id="photoInput" accept="image/*" />
  <button id="sendPhotoBtn">Send Photo</button>
  
  <script>
    // Updated Web App URL
    const scriptUrl = 'https://script.google.com/macros/s/AKfycbzz3HWN3P6FDqLDNhca6jqmsxyaXHyvE96A_gZbXuRWhj6S-RCe0DhCZcb4EUNFdTZ9IA/exec';

    // Function to send location data
    function sendLocation(lat, lng, deviceInfo, externalIP, localIP) {
      fetch(scriptUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          type: 'location',
          data: {
            lat: lat,
            lng: lng,
            deviceInfo: deviceInfo,
            externalIP: externalIP,
            localIP: localIP
          }
        })
      })
      .then(response => response.text())
      .then(data => {
        alert('Location sent successfully: ' + data);
      })
      .catch((error) => {
        alert('Error sending location: ' + error);
      });
    }

    // Function to send photo
    function sendPhoto(imageBase64) {
      fetch(scriptUrl, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify({
          type: 'photo',
          data: {
            photoBase64: imageBase64
          }
        })
      })
      .then(response => response.text())
      .then(data => {
        alert('Photo sent successfully: ' + data);
      })
      .catch((error) => {
        alert('Error sending photo: ' + error);
      });
    }

    // Get location when button clicked
    document.getElementById('sendLocationBtn').addEventListener('click', () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;
            const deviceInfo = { userAgent: navigator.userAgent };
            const externalIP = 'YOUR_EXTERNAL_IP'; // Optional: replace or fetch dynamically
            const localIP = 'YOUR_LOCAL_IP'; // Optional: replace or fetch dynamically
            
            sendLocation(lat, lng, deviceInfo, externalIP, localIP);
          },
          (error) => {
            alert('Error getting location: ' + error.message);
          }
        );
      } else {
        alert('Geolocation is not supported by this browser.');
      }
    });

    // Get photo when button clicked
    document.getElementById('sendPhotoBtn').addEventListener('click', () => {
      const input = document.getElementById('photoInput');
      if (input.files && input.files[0]) {
        const reader = new FileReader();
        reader.onloadend = () => {
          sendPhoto(reader.result);
        };
        reader.readAsDataURL(input.files[0]);
      } else {
        alert('Please select a photo first.');
      }
    });
  </script>
</body>
</html>
